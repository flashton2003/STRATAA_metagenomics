



## Sources
```{r}
source("/Users/flashton/Dropbox/GordonGroup/STRATAA_Microbiome/from_Leo/Leonardos_analysis/bin/core_functions.R")
source("/Users/flashton/Dropbox/GordonGroup/STRATAA_Microbiome/from_Leo/Leonardos_analysis/bin/config.R")
```

## read in metadata

```{r}
metadata <- read_metadata(metadata_handle)

```


## Setting general params

```{r}
filename_regex = "\\d+_\\d+_\\d+" #for patch and strata
```



## Run one beta diversity analysis


```{r}

taxonomic_level <- "species"
countries_to_include <- c('Malawi', 'Bangladesh', 'Nepal')



# todo - turn the below into a function
run_calculate_beta <- function(output_folder, tax_level, countries, meta){
  filtered_otu.unnormalised <- run_make_filtered_otu_table(output_folder, tax_level, countries)
  meta_filtered <- meta %>% filter(Country %in% countries)
  beta_dir <- file.path(output_folder, '4_beta')
  if (!dir.exists(beta_dir)){ dir.create(beta_dir) }
  beta_pca_output <- calculate_beta(filtered_otu.unnormalised, meta_filtered, beta_dir)
}


run_calculate_beta(output_folder_all_three, taxonomic_level, countries_to_include, metadata)

```

