

## Imports
```{r}
library(tidyr)
library(kableExtra)
```


## Sources
```{r}
source("/Users/flashton/Dropbox/GordonGroup/STRATAA_Microbiome/from_Leo/Leonardos_analysis/bin/core_functions.R")

```

## Setting file paths

```{r}

metadata_handle <- "/Users/flashton/Dropbox/GordonGroup/STRATAA_Microbiome/from_Leo/Leonardos_analysis/0_metadata/full_meta.tsv"

```


## Metadata basics

```{r}
meta <- read_metadata(metadata_handle)

#table(meta$Group, meta$Country)
#table(meta$Sex, meta$Country)
#table(meta$age_bracket, meta$Country)
#table(meta$Antibiotics_taken_before_sampling_yes_no_assumptions, meta$Country)

#round(prop.table(table(meta$Group, meta$Country)), 2)

meta_subset <- meta %>% select(Group, Sex, Country, Age, Antibiotics_taken_before_sampling_yes_no_assumptions)

pct_female <- meta_subset %>% group_by(Group, Country, Sex) %>% summarise(n = n()) %>% pivot_wider(names_from = c(Sex), values_from = n) %>% mutate(pct_fem = (Female / sum(c(Female, Male))) * 100) %>% select(c(Group, Country, pct_fem))

pct_antibiotics <- meta_subset %>% group_by(Group, Country, Antibiotics_taken_before_sampling_yes_no_assumptions) %>% summarise(n = n()) %>% pivot_wider(names_from = c(Antibiotics_taken_before_sampling_yes_no_assumptions), values_from = n)
pct_antibiotics[is.na(pct_antibiotics)] <- 0
pct_antibiotics <- pct_antibiotics %>% mutate(pct_anti = (Yes / sum(c(No, Yes, Unknown))) * 100) %>% select(c(Group, Country, pct_anti))


table_baseline_chars <- meta_subset %>% group_by(Group, Country) %>% summarise(median_age = median(Age)) %>% left_join(pct_female, by = c('Group', 'Country')) %>% left_join(pct_antibiotics, by = c('Group', 'Country'))

table_baseline_chars %>% kbl(digits = c(NA, NA, 0, 1, 1)) %>% kable_styling()

```

